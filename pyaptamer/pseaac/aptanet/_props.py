__author__ = "satvshr"
__all__ = ["aa_props"]

import numpy as np
import pandas as pd


def aa_props(prop_indices=None, type="numpy", normalize=True):
    """
    Amino acid physicochemical property matrix for PSeAAC.

    This function provides a 20x21 matrix of physicochemical properties for the
    20 standard amino acids. Each row corresponds to an amino acid (in the order:
    A, C, D, E, F, G, H, I, K, L, M, N, P, Q, R, S, T, V, W, Y), and each column
    corresponds to a property (P1–P21). The properties are in the order:

    - Hydrophobicity
    - Hydrophilicity
    - Side-chain Mass
    - Polarity
    - Molecular Weight
    - Melting Point
    - Transfer Free Energy
    - Buriability
    - Bulkiness
    - Solvation Free Energy
    - Relative Mutability
    - Residue Volume
    - Volume
    - Amino Acid Distribution
    - Hydration Number
    - Isoelectric Point
    - Compressibility
    - Chromatographic Index
    - Unfolding Entropy Change
    - Unfolding Enthalpy Change
    - Unfolding Gibbs Free Energy Change

    References
    ----------

    - https://github.com/nedaemami/AptaNet/blob/main/feature_extraction.py
    - Hydrophobicity values are from JACS, 1962, 84: 4240-4246. (C. Tanford)
    - Hydrophilicity values are from PNAS, 1981, 78:3824-3828 (T.P.Hopp & K.R.Woods)
    - Side-chain mass for each of the 20 amino acids.
    - Polarity values are from JACS, 1962, 84: 4240-4246. (C. Tanford)
    - Molecular weight values are from PNAS, 1981, 78:3824-3828 (T.P.Hopp & K.R.Woods)
    - Melting point for each of the 20 amino acids.
    - Transfer free energy values are from JACS, 1962, 84: 4240-4246. (C. Tanford)
    - Buriability values are from PNAS, 1981, 78:3824-3828 (T.P.Hopp & K.R.Woods)
    - Bulkiness for each of the 20 amino acids.
    - Solvation free energy values are from JACS, 1962, 84: 4240-4246. (C. Tanford)
    - Relative mutability values are from PNAS, 1981, 78:3824-3828
      (T.P.Hopp & K.R.Woods)
    - Residue volume for each of the 20 amino acids.
    - Volume values are from JACS, 1962, 84: 4240-4246. (C. Tanford)
    - Amino acid distribution values are from PNAS, 1981, 78:3824-3828
    (T.P.Hopp & K.R.Woods)
    - Hydration number for each of the 20 amino acids.
    - Isoelectric point values are from JACS, 1962, 84: 4240-4246. (C. Tanford)
    - Compressibility values are from PNAS, 1981, 78:3824-3828
    (T.P.Hopp & K.R.Woods)
    - Chromatographic index for each of the 20 amino acids.
    - Unfolding entropy change values are from JACS, 1962, 84: 4240-4246. (C. Tanford)
    - Unfolding enthalpy change values are from PNAS, 1981, 78:3824-3828
    (T.P.Hopp & K.R.Woods)
    - Unfolding Gibbs free energy change for each of the 20 amino acids.

    Parameters
    ----------
    prop_indices : list of int, optional
        List of indices (0-based) of properties to include (e.g., [0, 4, 7]).
        If None, returns all 21 properties.
    type : {'numpy', 'pandas'}, default='numpy'
        If 'pandas', returns a DataFrame with amino acid and property labels.
        If 'numpy', returns a numpy array.
    normalize : bool, default=True
        If True, each property column is standardized using z-score normalization:
        the mean value is subtracted and the result is divided by the standard
        deviation across the 20 amino acids — i.e., (x - mean) / std.
        This rescales each property to have zero mean and unit variance for
        comparability.

    Returns
    -------
    props : numpy.ndarray or pandas.DataFrame (depending on `type`)

        - Rows: standard amino acids (A, C, D, ..., Y)
        - Columns: physicochemical properties of the standard amino acids.
        - Entries: raw or normalized property values depending on `normalize`.

    Examples
    --------
    >>> from pyaptamer.pseaac.aptanet._props import aa_props
    >>> df = aa_props()
    >>> arr = aa_props(type="numpy", normalize=True)
    """
    aa_order = [
        "A",
        "C",
        "D",
        "E",
        "F",
        "G",
        "H",
        "I",
        "K",
        "L",
        "M",
        "N",
        "P",
        "Q",
        "R",
        "S",
        "T",
        "V",
        "W",
        "Y",
    ]
    prop_names = [
        "hydrophobicity",
        "hydrophilicity",
        "side_chain_mass",
        "polarity",
        "molecular_weight",
        "melting_point",
        "transfer_free_energy",
        "buriability",
        "bulkiness",
        "solvation_free_energy",
        "relative_mutability",
        "residue_volume",
        "volume",
        "aa_distribution",
        "hydration_number",
        "isoelectric_point",
        "compressibility",
        "chromatographic_index",
        "unfolding_entropy_change",
        "unfolding_enthalpy_change",
        "unfolding_gibbs_free_energy",
    ]
    # 20x21 property matrix, rows = AAs, columns = P1-P21
    props = np.array(
        [
            [
                0.62,
                0.29,
                -0.90,
                -0.74,
                1.19,
                0.48,
                -0.40,
                1.38,
                -1.50,
                1.06,
                0.64,
                -0.78,
                0.12,
                -0.85,
                -2.53,
                -0.18,
                -0.05,
                1.08,
                0.81,
                0.26,
            ],
            [
                -0.5,
                -1.0,
                3.0,
                3.0,
                -2.5,
                0.0,
                -0.5,
                -1.8,
                3.0,
                -1.8,
                -1.3,
                0.2,
                0.0,
                0.2,
                3.0,
                0.3,
                -0.4,
                -1.5,
                -3.4,
                -2.3,
            ],
            [
                15.0,
                47.0,
                59.0,
                73.0,
                91.0,
                1.0,
                82.0,
                57.0,
                73.0,
                57.0,
                75.0,
                58.0,
                42.0,
                72.0,
                101.0,
                31.0,
                45.0,
                43.0,
                130.0,
                107.0,
            ],
            [
                0.5,
                2.5,
                -1.0,
                2.5,
                -2.5,
                0.0,
                -0.5,
                1.8,
                3.0,
                -1.8,
                -1.3,
                0.2,
                -1.4,
                0.2,
                3.0,
                0.3,
                -0.4,
                -1.5,
                -3.4,
                -2.3,
            ],
            [
                5.3,
                3.6,
                1.3,
                3.3,
                2.3,
                4.8,
                1.4,
                3.1,
                4.1,
                4.7,
                1.1,
                3.0,
                2.5,
                2.4,
                2.6,
                4.5,
                3.7,
                4.2,
                0.8,
                2.3,
            ],
            [
                0.81,
                0.71,
                1.17,
                0.53,
                1.20,
                0.88,
                0.92,
                1.48,
                0.77,
                1.24,
                1.05,
                0.62,
                0.61,
                0.98,
                0.85,
                0.92,
                1.18,
                1.66,
                1.18,
                1.23,
            ],
            [
                58.0,
                -97.0,
                116.0,
                -131.0,
                92.0,
                -11.0,
                -73.0,
                107.0,
                -24.0,
                95.0,
                78.0,
                -93.0,
                -79.0,
                -139.0,
                -184.0,
                -34.0,
                -7.0,
                100.0,
                59.0,
                -11.0,
            ],
            [
                1.37,
                8.93,
                -4.47,
                4.04,
                -7.96,
                3.39,
                -1.65,
                -7.92,
                7.70,
                -8.68,
                -7.13,
                6.29,
                6.25,
                3.88,
                1.33,
                4.08,
                4.02,
                -6.94,
                0.79,
                -4.73,
            ],
            [
                6.77,
                8.57,
                0.31,
                12.93,
                1.92,
                7.95,
                2.80,
                2.72,
                10.20,
                4.43,
                1.87,
                5.50,
                4.79,
                5.24,
                6.87,
                5.41,
                5.36,
                3.57,
                0.54,
                2.26,
            ],
            [
                0.87,
                0.66,
                1.52,
                0.67,
                2.87,
                0.10,
                0.87,
                3.15,
                1.64,
                2.17,
                1.67,
                0.09,
                2.77,
                0.00,
                0.85,
                0.07,
                0.07,
                1.87,
                3.77,
                2.67,
            ],
            [
                1.09,
                0.77,
                0.50,
                0.92,
                0.50,
                1.25,
                0.67,
                0.66,
                1.25,
                0.44,
                0.45,
                1.14,
                2.96,
                0.83,
                0.97,
                1.21,
                1.33,
                0.56,
                0.62,
                0.94,
            ],
            [
                0.91,
                1.40,
                0.93,
                0.97,
                0.72,
                1.51,
                0.90,
                0.65,
                0.82,
                0.59,
                0.58,
                1.64,
                1.66,
                0.94,
                1.00,
                1.23,
                1.04,
                0.60,
                0.67,
                0.92,
            ],
            [
                0.92,
                0.48,
                1.16,
                0.61,
                1.25,
                0.61,
                0.93,
                1.81,
                0.70,
                1.30,
                1.19,
                0.60,
                0.40,
                0.95,
                0.93,
                0.82,
                1.12,
                1.81,
                1.54,
                1.53,
            ],
            [
                0.96,
                0.90,
                1.13,
                0.33,
                1.37,
                0.90,
                0.87,
                1.54,
                0.81,
                1.26,
                1.29,
                0.72,
                0.75,
                1.18,
                0.67,
                0.77,
                1.23,
                1.41,
                1.13,
                1.07,
            ],
            [
                0.90,
                0.47,
                1.24,
                0.62,
                1.23,
                0.56,
                1.12,
                1.54,
                0.74,
                1.26,
                1.09,
                0.62,
                0.42,
                1.18,
                1.02,
                0.87,
                1.30,
                1.53,
                1.75,
                1.68,
            ],
            [
                6.00,
                5.05,
                2.77,
                5.22,
                5.48,
                5.97,
                7.59,
                6.02,
                9.74,
                5.98,
                5.74,
                5.41,
                6.30,
                5.65,
                10.76,
                5.68,
                5.66,
                5.96,
                5.89,
                5.66,
            ],
            [
                -25.5,
                -32.82,
                -33.12,
                -36.17,
                -34.54,
                -27.0,
                -31.84,
                -31.78,
                -32.4,
                -31.78,
                -31.18,
                -30.9,
                -23.25,
                -32.6,
                -26.62,
                -29.88,
                -31.23,
                -30.62,
                -30.24,
                -35.01,
            ],
            [
                9.9,
                2.8,
                2.8,
                3.2,
                18.8,
                5.6,
                8.2,
                17.1,
                3.5,
                17.6,
                14.7,
                5.4,
                14.8,
                9.0,
                4.6,
                6.9,
                9.5,
                14.3,
                17.0,
                15.0,
            ],
            [
                0.54,
                -4.14,
                -0.26,
                -0.19,
                -4.66,
                -0.31,
                -0.23,
                -0.27,
                1.13,
                -0.24,
                -2.36,
                1.74,
                -0.08,
                1.53,
                3.69,
                -0.24,
                -0.28,
                -0.36,
                -2.69,
                -2.82,
            ],
            [
                0.51,
                5.21,
                0.18,
                0.05,
                6.82,
                -0.23,
                0.79,
                0.19,
                -1.45,
                0.17,
                2.89,
                -2.03,
                0.02,
                -1.76,
                -4.40,
                -0.16,
                0.04,
                0.30,
                4.47,
                3.73,
            ],
            [
                -0.02,
                1.08,
                -0.08,
                -0.13,
                2.16,
                0.09,
                0.56,
                -0.08,
                -0.32,
                -0.08,
                0.53,
                -0.30,
                -0.06,
                -0.23,
                -0.71,
                -0.40,
                -0.24,
                -0.06,
                1.78,
                -0.91,
            ],
        ]
    ).T  # shape (20, 21)

    if normalize:
        props = np.array(
            [
                [
                    0.636,
                    0.298,
                    -0.924,
                    -0.759,
                    1.221,
                    0.493,
                    -0.41,
                    1.416,
                    -1.539,
                    1.088,
                    0.657,
                    -0.8,
                    0.123,
                    -0.872,
                    -2.596,
                    -0.185,
                    -0.051,
                    1.108,
                    0.831,
                    0.267,
                ],
                [
                    -0.152,
                    -0.418,
                    1.713,
                    1.713,
                    -1.218,
                    0.115,
                    -0.152,
                    -0.845,
                    1.713,
                    -0.845,
                    -0.578,
                    0.221,
                    0.115,
                    0.221,
                    1.713,
                    0.274,
                    -0.099,
                    -0.685,
                    -1.697,
                    -1.111,
                ],
                [
                    -1.592,
                    -0.53,
                    -0.131,
                    0.334,
                    0.931,
                    -2.057,
                    0.632,
                    -0.198,
                    0.334,
                    -0.198,
                    0.4,
                    -0.164,
                    -0.696,
                    0.3,
                    1.263,
                    -1.061,
                    -0.596,
                    -0.662,
                    2.226,
                    1.462,
                ],
                [
                    0.329,
                    1.417,
                    -0.487,
                    1.417,
                    -1.303,
                    0.057,
                    -0.215,
                    1.036,
                    1.689,
                    -0.922,
                    -0.65,
                    0.166,
                    -0.704,
                    0.166,
                    1.689,
                    0.22,
                    -0.16,
                    -0.759,
                    -1.792,
                    -1.194,
                ],
                [
                    1.755,
                    0.429,
                    -1.365,
                    0.195,
                    -0.585,
                    1.365,
                    -1.287,
                    0.039,
                    0.819,
                    1.287,
                    -1.521,
                    -0.039,
                    -0.429,
                    -0.507,
                    -0.351,
                    1.131,
                    0.507,
                    0.897,
                    -1.755,
                    -0.585,
                ],
                [
                    -0.659,
                    -1.007,
                    0.593,
                    -1.633,
                    0.697,
                    -0.416,
                    -0.277,
                    1.671,
                    -0.798,
                    0.836,
                    0.176,
                    -1.32,
                    -1.355,
                    -0.068,
                    -0.52,
                    -0.277,
                    0.628,
                    2.297,
                    0.628,
                    0.802,
                ],
                [
                    0.735,
                    -0.968,
                    1.372,
                    -1.341,
                    1.108,
                    -0.023,
                    -0.704,
                    1.273,
                    -0.166,
                    1.141,
                    0.955,
                    -0.924,
                    -0.77,
                    -1.429,
                    -1.924,
                    -0.276,
                    0.021,
                    1.196,
                    0.746,
                    -0.023,
                ],
                [
                    0.219,
                    1.552,
                    -0.811,
                    0.69,
                    -1.427,
                    0.575,
                    -0.314,
                    -1.42,
                    1.335,
                    -1.554,
                    -1.281,
                    1.087,
                    1.08,
                    0.662,
                    0.212,
                    0.697,
                    0.686,
                    -1.247,
                    0.117,
                    -0.857,
                ],
                [
                    0.56,
                    1.13,
                    -1.484,
                    2.509,
                    -0.975,
                    0.933,
                    -0.696,
                    -0.722,
                    1.645,
                    -0.181,
                    -0.991,
                    0.158,
                    -0.067,
                    0.076,
                    0.592,
                    0.13,
                    0.114,
                    -0.453,
                    -1.411,
                    -0.867,
                ],
                [
                    -0.479,
                    -0.663,
                    0.09,
                    -0.654,
                    1.271,
                    -1.153,
                    -0.479,
                    1.516,
                    0.195,
                    0.658,
                    0.221,
                    -1.161,
                    1.183,
                    -1.24,
                    -0.496,
                    -1.179,
                    -1.179,
                    0.396,
                    2.058,
                    1.096,
                ],
                [
                    0.253,
                    -0.338,
                    -0.836,
                    -0.061,
                    -0.836,
                    0.548,
                    -0.522,
                    -0.541,
                    0.548,
                    -0.947,
                    -0.928,
                    0.345,
                    3.703,
                    -0.227,
                    0.031,
                    0.474,
                    0.696,
                    -0.725,
                    -0.614,
                    -0.024,
                ],
                [
                    -0.223,
                    1.256,
                    -0.163,
                    -0.042,
                    -0.797,
                    1.588,
                    -0.254,
                    -1.008,
                    -0.495,
                    -1.189,
                    -1.219,
                    1.98,
                    2.04,
                    -0.133,
                    0.048,
                    0.743,
                    0.169,
                    -1.159,
                    -0.948,
                    -0.193,
                ],
                [
                    -0.277,
                    -1.356,
                    0.311,
                    -1.037,
                    0.532,
                    -1.037,
                    -0.253,
                    1.905,
                    -0.816,
                    0.655,
                    0.385,
                    -1.062,
                    -1.552,
                    -0.203,
                    -0.253,
                    -0.522,
                    0.213,
                    1.905,
                    1.243,
                    1.219,
                ],
                [
                    -0.187,
                    -0.393,
                    0.397,
                    -2.352,
                    1.221,
                    -0.393,
                    -0.496,
                    1.805,
                    -0.703,
                    0.843,
                    0.947,
                    -1.012,
                    -0.909,
                    0.569,
                    -1.184,
                    -0.84,
                    0.74,
                    1.359,
                    0.397,
                    0.191,
                ],
                [
                    -0.402,
                    -1.503,
                    0.469,
                    -1.119,
                    0.443,
                    -1.273,
                    0.161,
                    1.237,
                    -0.812,
                    0.52,
                    0.085,
                    -1.119,
                    -1.631,
                    0.315,
                    -0.095,
                    -0.479,
                    0.622,
                    1.211,
                    1.775,
                    1.595,
                ],
                [
                    -0.078,
                    -0.667,
                    -2.081,
                    -0.562,
                    -0.401,
                    -0.097,
                    0.907,
                    -0.066,
                    2.24,
                    -0.091,
                    -0.24,
                    -0.444,
                    0.108,
                    -0.295,
                    2.872,
                    -0.277,
                    -0.289,
                    -0.103,
                    -0.147,
                    -0.289,
                ],
                [
                    1.728,
                    -0.604,
                    -0.7,
                    -1.671,
                    -1.152,
                    1.25,
                    -0.292,
                    -0.273,
                    -0.47,
                    -0.273,
                    -0.082,
                    0.008,
                    2.445,
                    -0.534,
                    1.371,
                    0.333,
                    -0.097,
                    0.097,
                    0.218,
                    -1.302,
                ],
                [
                    -0.025,
                    -1.322,
                    -1.322,
                    -1.249,
                    1.601,
                    -0.81,
                    -0.335,
                    1.291,
                    -1.194,
                    1.382,
                    0.852,
                    -0.847,
                    0.871,
                    -0.189,
                    -0.993,
                    -0.573,
                    -0.098,
                    0.779,
                    1.273,
                    0.907,
                ],
                [
                    0.549,
                    -1.863,
                    0.137,
                    0.173,
                    -2.131,
                    0.111,
                    0.152,
                    0.131,
                    0.853,
                    0.147,
                    -0.946,
                    1.167,
                    0.229,
                    1.059,
                    2.172,
                    0.147,
                    0.126,
                    0.085,
                    -1.116,
                    -1.183,
                ],
                [
                    -0.099,
                    1.717,
                    -0.227,
                    -0.277,
                    2.339,
                    -0.385,
                    0.009,
                    -0.223,
                    -0.857,
                    -0.231,
                    0.82,
                    -1.081,
                    -0.289,
                    -0.976,
                    -1.996,
                    -0.358,
                    -0.281,
                    -0.18,
                    1.431,
                    1.145,
                ],
                [
                    -0.2,
                    1.276,
                    -0.28,
                    -0.348,
                    2.725,
                    -0.052,
                    0.578,
                    -0.28,
                    -0.602,
                    -0.28,
                    0.538,
                    -0.576,
                    -0.254,
                    -0.482,
                    -1.126,
                    -0.71,
                    -0.495,
                    -0.254,
                    2.215,
                    -1.394,
                ],
            ]
        ).T  # shape (20, 21)

    if prop_indices is not None:
        props = props[:, prop_indices]
        selected_names = [prop_names[i] for i in prop_indices]
    else:
        selected_names = prop_names

    if type == "pandas":
        return pd.DataFrame(props, index=aa_order, columns=selected_names)
    elif type == "numpy":
        return props
    else:
        raise ValueError("type must be 'numpy' or 'pandas'")
